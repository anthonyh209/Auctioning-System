<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Create an Auction</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <script src="js/jquery.js"></script>
    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

</head>

<!--Sellers can create auctions for particular items, setting suitable conditions and
features of the items including the item description, categorisation, starting price,
reserve price and end date.-->
<nav style="margin-bottom: 1%">

    <div class="row">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="b-home.html">
                    <img width="100" src="efast.png">
                </a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"> Shop by Category
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">Action</a>
                            </li>
                            <li>
                                <a href="#">Another action</a>
                            </li>
                            <li>
                                <a href="#">Something else here</a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#">Separated link</a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#">One more separated link</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <form class="navbar-form navbar-left" action="/action_page.php">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search...">
                    </div>
                    <button type="submit" class="btn btn-danger navbar-btn">Search</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#">
                            <span class="glyphicon glyphicon-user"></span>Your Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<!--Buyers can bid for items and see the bids other users make as they are received.
The system will manage the auction until the set end time and award the item to the highest bidder.
The system should confirm to both the winner and seller of an auction its outcome.-->

<body onload = "check_bid_history()">
    <div style="padding-right: 3%; padding-left: 3%">

        <button type="button" class="btn btn-primary btn-sm">Back to search results</button>
        <div id="spacer" style="height: 20px"></div>



        <div class="card">
            <div class="card-header">
                Auction details
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-4">
                        <div class="card" style="height: 100%">
                            <img src="img/fashion.jpg" alt="..." class="img-thumbnail" style="height: 100%">
                        </div>
                    </div>
                    <div class="col-8">
                        <div class="card text-left">
                            <div class="card-header">
                                Some crappy watch no one wants to bid on (title)
                            </div>
                            <div class="card-block" style="padding: 20px">
                                <h4 class="card-title">Current highest bid: $5</h4>
                                <div id="spacer" style="height: 20px"></div>
                                <div class="input-group-prepend">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                                        <span class="input-group-btn">
                                            <button class="btn btn-primary" type="button">Submit bid!</button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer text-muted">
                                Remaining Time
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <br>
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#home">Description</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#menu1">Product Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#bid_history">Bids History</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div id="home" class="container tab-pane active">
                <br>
                <h3>HOME</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
                    magna aliqua.</p>
            </div>
            <div id="menu1" class="container tab-pane fade">
                <br>
                <h3>Menu 1</h3>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            </div>
            <div id="bid_history" class="container tab-pane fade">
                <br>
                <h3>Bids History</h3>
                <p>Start of bidding at </p>
            </div>
        </div>

<script>
    function check_bid_history(){
        id_auction = "AU_000001"; //should have global scope & should be populated on load of page - HARDCODED for now
        var xhttp;
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                old_counter = this.responseText;
                alert(old_counter);
            }
        };
        xhttp.open("GET", "get-auction-counter.php?id_auction="+id_auction, true);
        xhttp.send();

        setInterval(function(){     //tells the page to call get-auction-counter.php every 3 seconds
            var xhttp;
            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    new_counter = this.responseText;
                    alert(new_counter);
                    //include code which compares old_counter with new_counter, and if different, update old_counter in JS
                    //and refresh the bid history tab with latest bid history
                }
            };
            xhttp.open("GET", "get-auction-counter.php?id_auction="+id_auction, true);
            xhttp.send();
            }, 3000);
    }
</script>


</body>

</html>